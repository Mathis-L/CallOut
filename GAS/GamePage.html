<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <title>Call Out! - The Game</title>
    <!-- External dependencies -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS file inclusion -->
    <?!= include('GamePage.css'); ?>

</head>
<body>
  <div class="container">
    
    <div id="player-list-area" class="card">
      <button id="leaveGameBtn">Bail Out!</button>
      <h3>Party Peeps:</h3>
      <ul id="player-list">
        <li class="loading status-message">Summoning players...</li>
      </ul>
    </div>

    <div class="card game-card"> 
      <div id="game-content">
       <!-- Game phases -->
        <section id="voting-phase" class="game-phase">
          <h2>WHO'S IT GONNA BE?!</h2>
          <p id="current-question">The big question is...</p>
          <div id="player-vote-options">
            <!-- Player buttons generated by JS -->
          </div>
          <p id="vote-status" class="status-message">Point your finger... wisely!</p>
        </section>

        <!-- Results Phase (Normal) -->
        <section id="results-phase" class="game-phase">
            <h2>THE VERDICT!</h2>
            <div id="results-display">
                 <!-- VOTE results are generated here by JS -->
            </div>
            <button id="next-round-btn">Ready For More?</button>
            <p id="ready-status" class="status-message">Waiting for the eager beavers...</p>
        </section>

       <!-- Selection Phase for Confession -->
        <section id="confession-selection-phase" class="game-phase">
            <h2>VENGEANCE!</h2>
            <p id="confession-selection-subtitle" class="confession-subtitle"></p>
            <div class="confession-question-box">
                <p id="confession-question-text-selection"></p>
            </div>
            <div id="player-confession-target-options">
                <!-- Target players will be generated by JS -->
            </div>
            <p id="confession-selection-instruction" class="confession-instruction"></p>
        </section>

         <section id="confession-question-phase" class="game-phase">
            <h2>CONFESSION TIME</h2>
            <p id="confession-question-subtitle" class="confession-subtitle"></p>
            <div class="confession-question-box">
                <p id="confession-question-text"></p>
            </div>

            <!-- For the player who is answering -->
            <p id="confession-answer-prompt" class="confession-instruction" style="display: none; color: var(--clr-primary-orange); font-weight: bold;"></p>
            
            <!-- For the players who are judging -->
            <div id="confession-judgment-area" style="display: none; width: 100%;">
                <p id="confession-judgment-instruction" class="confession-instruction"></p>
                <div id="judgment-buttons-container" style="display:flex; gap:15px; width:100%; margin-top: 10px;">
                    <button id="judgment-convinced-btn" style="background-color: var(--clr-success);">Convinced</button>
                    <button id="judgment-not-convinced-btn" style="background-color: var(--clr-error);">Not buying it!</button>
                </div>
                 <div class="jury-meter" id="jury-meter">
                    <div class="jury-fill"></div>
                </div>
                <p id="judgment-status" class="status-message">Awaiting votes...</p>
            </div>
        </section>


        <!-- Confession Result -->
        <section id="confession-result-phase" class="game-phase">
            <h2>THE CONFESSION VERDICT</h2>
            <div id="confession-verdict-display" class="card">
                <!-- The confession verdict is generated here by JS -->
            </div>
            <button id="next-round-btn-confession">Ready For The Next Round?</button>
            <p id="ready-status-confession" class="status-message">Waiting for players...</p>
        </section>

        <section id="waiting-area" class="game-phase active">
          <h2>GET READY!</h2>
          <p id="waiting-message" class="status-message">The game is brewing...</p>
          <div class="loader"></div>
        </section>

        <p id="pause-message" class="status-message">Hold your horses! Game paused...</p>
      </div>
    </div>

     <div id="game-error-prompt" class="card" style="display: none; background-color: #F8D7DA; border-color: #E94F37;">
        <h2 style="color: #E94F37;">Connection Error!</h2>
        <p class="status-message" id="game-error-text" style="color: #4A2F48;">
          Something went wrong while trying to connect to the game.
        </p>
        <a href="#" id="game-error-home-link" class="button-like-link" style="background-color: var(--clr-primary-green); margin-top: 20px;">
          Return to Home
        </a>
    </div>
  </div>

  <!-- Popup for the coin toss animation -->
  <div id="coin-toss-popup" class="popup-overlay">
      <div class="popup-content">
          <div id="popup-tosser-name">
              <!-- Avatar and name populated by JS -->
              is flipping out...
          </div>
          <div class="coin-animation-spot-popup">
              <div class="coin" id="popup-coin">
                  <div class="head"></div> <!-- Heads -->
                  <div class="tail"></div> <!-- Tails -->
              </div>
          </div>
          <p class="popup-status">Coin in the air!</p>
      </div>
  </div>

  <div id="leave-game-popup" class="popup-overlay">
    <div class="popup-content">
        <h2 id="leave-popup-title">Ending Game</h2>
        <div class="loader" id="leave-popup-loader"></div>
        <p id="leave-popup-message" class="status-message">Please wait...</p>
        <div id="leave-popup-actions" style="display: none; width: 100%; margin-top: 15px;">
            <!-- Action buttons will be inserted here by JS -->
        </div>
    </div>
</div>

    <!-- Script to pass server variables to the client -->
    <script>
        const firebaseConfig = <?!= firebaseConfig ?>;
        const gameId = "<?!= gameId ?>";
        const currentUserId = "<?!= userId ?>";
        const currentUserPseudo = "<?!= pseudo ?>";
    </script>

    <!-- Main JavaScript file inclusions -->
    <?!= include('Questions'); ?>
    <?!= include('GamePage.js'); ?>

</body>
</html>